---
- hosts: virthost
  any_errors_fatal: true
  gather_facts: true
  roles:
    # FIXME(bogdando) fails to restart libvirt in the chrooted container
    # allow the "roles/parts/libvirt/tasks/main.yml" to fail!
    - environment/setup
    - libvirt/teardown
    - { role: libvirt/setup/user, become: false }
    - libvirt/setup/overcloud
    - libvirt/setup/undercloud

- hosts: localhost
  any_errors_fatal: true
  gather_facts: true
  roles:
    - tripleo-inventory

- name: Install the undercloud
  hosts: undercloud
  any_errors_fatal: true
  gather_facts: no
  roles:
    - tripleo/undercloud

#- name: Deploy the overcloud
#  hosts: undercloud
#  gather_facts: no
#  roles:
#    - tripleo-overcloud

# OR install undercloud and HA overcloud
#- hosts: undercloud
#  vars:
#    extra_args: >
#      --control-scale 3
#      -e /usr/share/openstack-tripleo-heat-templates/environments/puppet-pacemaker.yaml
#      #OR for containers
#      -e environments/docker.yaml
#      --ntp-server pool.ntp.org
#  roles:
#    - tripleo-overcloud

# TODO install undercloud/overcloud with containers
# (extra_args: -e environments/docker.yaml, containerized_undercloud: true)
# see https://review.openstack.org/#/c/419040/ for undercloud
