# Undercloud TLS all-in-one BM/VM-libvirt scenario to host openshift VMs.
# Must be applied top-scope via -e@.
# Based on fs027 from quickstart.
undercloud_vcpu: 6
undercloud_memory: 20480
undercloud_use_custom_boot_images: false
undercloud_image_url: file://{{ image_cache_dir }}/undercloud.qcow2
enable_opstools_repo: false
deployed_server: false
deploy_multinode: false
overcloud_templates_path: /usr/share/openstack-tripleo-heat-templates
extra_tht_configs: /tmp/scripts/tht
configure_repos: true
release: master
dlrn_hash_tag: current-tripleo
undercloud_cloud_domain: rdocloud
undercloud_enable_ironic: false
undercloud_enable_ironic_inspector: false
undercloud_enable_telemetry: false
undercloud_enable_zaqar: true
undercloud_enable_mistral: true
# Should only be re-enabled on a 2nd deploy run
#-e {{overcloud_templates_path}}/environments/services-docker/octavia.yaml
undercloud_extra_services_args: >-
  -e {{overcloud_templates_path}}/environments/services-docker/undercloud-cinder.yaml
  -e {{overcloud_templates_path}}/environments/disable-telemetry.yaml
  -e {{working_dir}}/undercloud-parameter-defaults.yaml
  -e {{working_dir}}/tht/environments/all-in-one-local.yaml
  -e {{overcloud_templates_path}}/environments/docker.yaml
containerized_undercloud: true
step_install_undercloud: true
undercloud_install_script: undercloud-deploy.sh.j2
undercloud_docker_registry_host: docker.io
undercloud_docker_registry_namespace: tripleomaster
undercloud_docker_image_tag: "{{ dlrn_hash_tag }}"
extra_args: >-
  --ntp-server pool.ntp.org
network_isolation: false
enable_pacemaker: false
overcloud_ipv6: false
containerized_overcloud: false
containerized_undercloud: true
undercloud_undercloud_hostname: "undercloud.{{ undercloud_cloud_domain }}"
step_overcloud_image: false
step_glance_upload: false
step_register: false
step_root_device_size: false
step_root_device_hints: false
step_introspect: false
undercloud_generate_service_certificate: true
ssl_overcloud: false
test_ping: false
run_tempest: false
enable_port_forward_for_tripleo_ui: false
delete_docker_cache: true
undercloud_rpm_dependencies: "python-tripleoclient*"
#local_docker_registry_host: "{{ hostvars['undercloud'].undercloud_ip }}"
#undercloud_ip: "{{ local_docker_registry_host }}"
undercloud_network_cidr: 192.168.0.0/24
# It should be eth1, which is brovc connected for the libvirt case
undercloud_local_interface: eth1
# It should match the libvirt brovc CIDR and
# ExternalAllocationPools to not overlap with brovc's dhcp ranges
undercloud_external_network_cidr: 192.168.23.0/24
external_network_cidr: "{{ undercloud_external_network_cidr }}"
local_docker_registry_host: "{{ undercloud_network_cidr|nthhost(1) }}"
undercloud_ip: "{{ undercloud_network_cidr|nthhost(1) }}"
undercloud_local_ip: "{{ undercloud_network_cidr|nthhost(1) }}"
undercloud_network_gateway: "{{ undercloud_network_cidr|nthhost(1) }}"
# Assumes libvirt brovc dhcp range ends on .50
undercloud_undercloud_public_vip: "{{ undercloud_external_network_cidr|nthhost(51) }}"
undercloud_undercloud_admin_vip: "{{ undercloud_network_cidr|nthhost(1) }}"
undercloud_masquerade_network: "{{ undercloud_network_cidr }}"
undercloud_dhcp_start: "{{ undercloud_network_cidr|nthhost(5) }}"
undercloud_dhcp_end: "{{ undercloud_network_cidr|nthhost(24) }}"
undercloud_inspection_iprange: "{{ undercloud_network_cidr|nthhost(25) }},{{ undercloud_network_cidr|nthhost(39) }}"
overcloud_dns_servers:
  - "{{ undercloud_network_cidr|nthhost(2) }}"
  - 208.67.222.220
undercloud_undercloud_nameservers:
  - 208.67.222.220
undercloud_resource_registry_args:
  "OS::TripleO::Undercloud::Net::SoftwareConfig": "{{ overcloud_templates_path }}/net-config-undercloud.yaml"
  "OS::TripleO::Network::Ports::RedisVipPort": "{{ overcloud_templates_path }}/network/ports/noop.yaml"
  "OS::TripleO::Network::Ports::ControlPlaneVipPort": "{{ overcloud_templates_path }}/deployed-server/deployed-neutron-port.yaml"
  "OS::TripleO::NodeExtraConfigPost": "{{ overcloud_templates_path }}/extraconfig/post_deploy/undercloud_post.yaml"
  "OS::TripleO::Services::DockerRegistry": "{{ overcloud_templates_path }}/puppet/services/docker-registry.yaml"
  "OS::TripleO::Network::Ports::ExternalVipPort": "{{ overcloud_templates_path }}/network/ports/external_from_pool.yaml"
undercloud_network_environment_args:
  ExternalNetCidr: "{{ undercloud_external_network_cidr }}"
  ExternalAllocationPools: >
    [{'start': '{{ undercloud_external_network_cidr|nthhost(128) }}',
    'end': '{{ undercloud_external_network_cidr|nthhost(250) }}'}]
  ControlPlaneSubnetCidr: "{{ undercloud_network_cidr|ipaddr('prefix') }}"
  ControlPlaneDefaultRoute: "{{ undercloud_network_cidr|nthhost(1) }}"
  EC2MetadataIp: "{{ undercloud_network_cidr|nthhost(1) }}"
  DnsServers: "{{ overcloud_dns_servers }}"
  ControlPlaneStaticRoutes: []
  UndercloudCtlplaneSubnets:
    ctlplane-subnet:
      NetworkCidr: "{{ undercloud_network_cidr }}"
      NetworkGateway: "{{ undercloud_network_cidr|nthhost(1) }}"
      DhcpRangeStart: "{{ undercloud_network_cidr|nthhost(5) }}"
      DhcpRangeEnd: "{{ undercloud_network_cidr|nthhost(24) }}"
  UndercloudCtlplaneLocalSubnet: 'ctlplane-subnet'
  # It should be eth0, which is brext connected for the libvirt case
  NeutronPublicInterface: eth0
  HypervisorNeutronPublicInterface: eth0
